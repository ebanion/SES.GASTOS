<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard | SES Gastos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        .metric-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.25);
        }
        
        .metric-card.green {
            border-left-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(16, 185, 129, 0.02) 100%);
        }
        
        .metric-card.yellow {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(245, 158, 11, 0.02) 100%);
        }
        
        .metric-card.red {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(239, 68, 68, 0.02) 100%);
        }
        
        .metric-card.blue {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.02) 100%);
        }
        
        .metric-card.purple {
            border-left-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(139, 92, 246, 0.02) 100%);
        }
        
        .health-badge {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 800;
            color: white;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            position: relative;
            animation: pulse-subtle 3s ease-in-out infinite;
        }
        
        @keyframes pulse-subtle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .health-badge.green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .health-badge.yellow {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .health-badge.red {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .trend-up {
            color: #10b981;
        }
        
        .trend-down {
            color: #ef4444;
        }
        
        .alert-badge {
            position: relative;
            display: inline-block;
        }
        
        .alert-badge .badge-dot {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse-dot 2s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .loading-skeleton {
            animation: skeleton-loading 1s linear infinite alternate;
        }
        
        @keyframes skeleton-loading {
            0% { background-color: rgba(209, 213, 219, 0.3); }
            100% { background-color: rgba(209, 213, 219, 0.6); }
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .nav-tab {
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            background: rgba(139, 92, 246, 0.1);
        }
        
        .nav-tab.active {
            border-bottom-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
            font-weight: 600;
        }
        
        .recommendation-card {
            border-left: 3px solid #8b5cf6;
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.05) 0%, transparent 100%);
        }
    </style>
</head>
<body class="p-6">
    <!-- Header -->
    <div class="max-w-7xl mx-auto mb-6">
        <div class="glass-card rounded-2xl p-6 flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 mb-1">
                    <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                    Dashboard de Analytics
                </h1>
                <p class="text-gray-600">Inteligencia financiera y fiscal en tiempo real</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="text-sm text-gray-500">Periodo actual</p>
                    <p class="text-lg font-semibold text-gray-800" id="current-period">Cargando...</p>
                </div>
                <div class="alert-badge">
                    <button id="alerts-btn" class="p-3 rounded-xl bg-white hover:bg-gray-50 transition-all shadow-md">
                        <i class="fas fa-bell text-xl text-gray-700"></i>
                    </button>
                    <span class="badge-dot" id="alert-dot" style="display: none;"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto mb-6">
        <div class="glass-card rounded-2xl p-2 flex space-x-2">
            <div class="nav-tab active px-6 py-3 rounded-xl" data-tab="overview">
                <i class="fas fa-home mr-2"></i>Vista General
            </div>
            <div class="nav-tab px-6 py-3 rounded-xl" data-tab="kpis">
                <i class="fas fa-chart-bar mr-2"></i>KPIs Hoteleros
            </div>
            <div class="nav-tab px-6 py-3 rounded-xl" data-tab="expenses">
                <i class="fas fa-wallet mr-2"></i>Análisis de Gastos
            </div>
            <div class="nav-tab px-6 py-3 rounded-xl" data-tab="fiscal">
                <i class="fas fa-file-invoice-dollar mr-2"></i>Fiscal
            </div>
            <div class="nav-tab px-6 py-3 rounded-xl" data-tab="simulator">
                <i class="fas fa-calculator mr-2"></i>Simulador
            </div>
        </div>
    </div>

    <!-- Content Container -->
    <div class="max-w-7xl mx-auto">
        
        <!-- TAB 1: Overview -->
        <div id="tab-overview" class="tab-content">
            
            <!-- Health Status Card -->
            <div class="glass-card rounded-2xl p-8 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Estado de Salud Financiera</h2>
                        <div id="health-message" class="text-lg text-gray-700 mb-4 leading-relaxed">
                            Analizando tu negocio...
                        </div>
                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 mb-1">Margen de Beneficio</p>
                                <p class="text-3xl font-bold text-gray-800" id="health-margin">--%</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 mb-1">Tasa de Ocupación</p>
                                <p class="text-3xl font-bold text-gray-800" id="health-occupancy">--%</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 mb-1">Control de Gastos</p>
                                <p class="text-3xl font-bold text-gray-800" id="health-expenses">--%</p>
                            </div>
                        </div>
                    </div>
                    <div class="ml-8">
                        <div class="health-badge green" id="health-badge">
                            <span id="health-score">--</span>
                        </div>
                        <p class="text-center mt-4 text-sm font-semibold text-gray-600" id="health-status-text">Cargando...</p>
                    </div>
                </div>
            </div>

            <!-- KPIs Row -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- ADR Card -->
                <div class="metric-card glass-card rounded-2xl p-6 blue">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 rounded-xl bg-blue-100">
                            <i class="fas fa-euro-sign text-2xl text-blue-600"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-500">ADR</span>
                    </div>
                    <h3 class="text-4xl font-bold text-gray-800 mb-2" id="adr-value">€--</h3>
                    <p class="text-sm text-gray-600 mb-2">Average Daily Rate</p>
                    <div class="flex items-center">
                        <span class="trend-up mr-1" id="adr-trend">
                            <i class="fas fa-arrow-up"></i> -%
                        </span>
                        <span class="text-xs text-gray-500">vs. mes anterior</span>
                    </div>
                </div>

                <!-- Occupancy Card -->
                <div class="metric-card glass-card rounded-2xl p-6 purple">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 rounded-xl bg-purple-100">
                            <i class="fas fa-bed text-2xl text-purple-600"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-500">Ocupación</span>
                    </div>
                    <h3 class="text-4xl font-bold text-gray-800 mb-2" id="occupancy-value">--%</h3>
                    <p class="text-sm text-gray-600 mb-2">Tasa de ocupación</p>
                    <div class="flex items-center">
                        <span class="trend-up mr-1" id="occupancy-trend">
                            <i class="fas fa-arrow-up"></i> -%
                        </span>
                        <span class="text-xs text-gray-500">vs. mes anterior</span>
                    </div>
                </div>

                <!-- RevPAR Card -->
                <div class="metric-card glass-card rounded-2xl p-6 green">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 rounded-xl bg-green-100">
                            <i class="fas fa-chart-line text-2xl text-green-600"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-500">RevPAR</span>
                    </div>
                    <h3 class="text-4xl font-bold text-gray-800 mb-2" id="revpar-value">€--</h3>
                    <p class="text-sm text-gray-600 mb-2">Revenue Per Available Room</p>
                    <div class="flex items-center">
                        <span class="trend-up mr-1" id="revpar-trend">
                            <i class="fas fa-arrow-up"></i> -%
                        </span>
                        <span class="text-xs text-gray-500">vs. mes anterior</span>
                    </div>
                </div>
            </div>

            <!-- Income Comparison -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-money-bill-wave text-green-600 mr-2"></i>
                        Evolución de Ingresos
                    </h3>
                    <div class="chart-container">
                        <canvas id="income-chart"></canvas>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-coins text-blue-600 mr-2"></i>
                        Comparativa Mensual
                    </h3>
                    <div class="space-y-4 mt-8">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-600">Ingresos mes actual</span>
                                <span class="text-lg font-bold text-gray-800" id="current-income">€0</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-600">Ingresos mes anterior</span>
                                <span class="text-lg font-bold text-gray-600" id="previous-income">€0</span>
                            </div>
                            <hr class="my-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-semibold text-gray-700">Variación</span>
                                <span class="text-2xl font-bold" id="income-change">
                                    <span class="trend-up">
                                        <i class="fas fa-arrow-up"></i> 0%
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fiscal Alerts -->
            <div class="glass-card rounded-2xl p-6" id="alerts-container">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-bell text-orange-600 mr-2"></i>
                    Alertas Fiscales Activas
                </h3>
                <div id="alerts-list" class="space-y-3">
                    <!-- Alerts will be loaded here -->
                </div>
            </div>

        </div>

        <!-- TAB 2: KPIs (Hidden by default) -->
        <div id="tab-kpis" class="tab-content" style="display: none;">
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">KPIs Hoteleros Detallados</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Evolución ADR (6 meses)</h3>
                        <div class="chart-container">
                            <canvas id="adr-trend-chart"></canvas>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Ocupación Mensual</h3>
                        <div class="chart-container">
                            <canvas id="occupancy-trend-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: Expenses Analysis (Hidden by default) -->
        <div id="tab-expenses" class="tab-content" style="display: none;">
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Análisis de Gastos por Categoría</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Distribución de Gastos</h3>
                        <div class="chart-container">
                            <canvas id="expenses-pie-chart"></canvas>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Comparativa con Benchmark</h3>
                        <div class="chart-container">
                            <canvas id="expenses-benchmark-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Recomendaciones de Optimización</h3>
                <div id="recommendations-list" class="space-y-3">
                    <!-- Recommendations will be loaded here -->
                </div>
            </div>
        </div>

        <!-- TAB 4: Fiscal (Hidden by default) -->
        <div id="tab-fiscal" class="tab-content" style="display: none;">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-file-invoice text-blue-600 mr-2"></i>
                        IVA Trimestral
                    </h3>
                    <div id="iva-calculator">
                        <!-- IVA data will be loaded here -->
                    </div>
                </div>
                
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-receipt text-green-600 mr-2"></i>
                        IRPF Trimestral
                    </h3>
                    <div id="irpf-calculator">
                        <!-- IRPF data will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: Simulator (Hidden by default) -->
        <div id="tab-simulator" class="tab-content" style="display: none;">
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Simulador Fiscal</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Ingresos Anuales Proyectados (€)
                        </label>
                        <input type="number" id="sim-income" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-purple-600 focus:outline-none" value="60000">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Gastos Anuales Proyectados (€)
                        </label>
                        <input type="number" id="sim-expenses" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-purple-600 focus:outline-none" value="30000">
                    </div>
                </div>
                
                <button id="simulate-btn" class="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold rounded-xl hover:shadow-lg transition-all">
                    <i class="fas fa-calculator mr-2"></i>
                    Calcular Escenarios
                </button>
                
                <div id="simulation-results" class="mt-8">
                    <!-- Simulation results will be loaded here -->
                </div>
            </div>
        </div>

    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', path='/analytics_dashboard.js') }}"></script>
</body>
</html>
